<!-- lcg-generator.component.html -->
<div class="main-container">
  <h2 class="text-2xl font-bold mb-4 text-center">Generador Congruencial Lineal (LCG)</h2>
  <p class="text-sm text-gray-600 mb-4 text-center">F√≥rmula: X‚Çñ‚Çä‚ÇÅ = (a √ó X‚Çñ + c) mod m, donde m = 2^g</p>

  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
    <strong>Error:</strong> {{ errorMessage }}
  </div>

  <!-- Layout principal: Generador + Resultados -->
  <div class="main-layout">
    <!-- Columna izquierda: Formulario del generador -->
    <div class="generator-section">
      <form [formGroup]="form" (ngSubmit)="generate()" class="bg-gray-50 p-4 rounded-lg shadow-md">
        <h3 class="font-bold text-lg mb-3">Par√°metros del Generador</h3>
        
        <div class="form-group">
          <label class="block font-semibold mb-1">g (exponente):</label>
          <input formControlName="g" type="number" class="border p-2 rounded w-full" placeholder="Ej: 8">
        </div>
        
        <div class="form-group">
          <label class="block font-semibold mb-1">a (multiplicador):</label>
          <input formControlName="a" type="number" class="border p-2 rounded w-full" placeholder="Ej: 137">
        </div>
        
        <div class="form-group">
          <label class="block font-semibold mb-1">c (constante):</label>
          <input formControlName="c" type="number" class="border p-2 rounded w-full" placeholder="Ej: 0">
        </div>
        
        <div class="form-group">
          <label class="block font-semibold mb-1">X‚ÇÄ (semilla inicial):</label>
          <input formControlName="X0" type="number" class="border p-2 rounded w-full" placeholder="Ej: 1">
        </div>
        
        <div class="form-group">
          <label class="block font-semibold mb-1">N (iteraciones):</label>
          <input formControlName="N" type="number" class="border p-2 rounded w-full" placeholder="Auto">
        </div>

        <div class="flex flex-col gap-2 mt-4">
          <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded font-semibold transition">
            Generar
          </button>
          <button type="button" (click)="reset()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded font-semibold transition">
            Reiniciar
          </button>
        </div>
      </form>

      <!-- Par√°metros generados -->
      <div *ngIf="results.length > 0" class="bg-blue-50 p-4 rounded-lg mt-4 shadow-md">
        <h3 class="font-bold text-lg mb-2">Informaci√≥n</h3>
        <div class="info-grid">
          <div><strong>g:</strong> {{ g }}</div>
          <div><strong>m:</strong> {{ m }}</div>
          <div><strong>a:</strong> {{ a }}</div>
          <div><strong>c:</strong> {{ c }}</div>
          <div><strong>X‚ÇÄ:</strong> {{ X0 }}</div>
          <div><strong>N:</strong> {{ N }}</div>
        </div>
        <div *ngIf="cycleDetected" class="mt-3 text-orange-700 font-semibold">
          ‚ö†Ô∏è Ciclo detectado: Longitud = {{ cycleLength }}
        </div>
        <div *ngIf="!cycleDetected && results.length > 0" class="mt-3 text-green-700 font-semibold">
          ‚úì No se detect√≥ ciclo en {{ results.length }} iteraciones
        </div>
      </div>
    </div>

    <!-- Columna derecha: Tabla y Gr√°fico -->
    <div class="results-section" *ngIf="results.length > 0">
      <!-- Scatter Chart -->
      <div class="bg-white p-4 rounded-lg shadow-lg mb-4">
        <canvas #scatterChart style="width: 100%; height: 350px;"></canvas>
      </div>

      <!-- Pruebas de Validaci√≥n -->
      <div *ngIf="testsPerformed" class="bg-white p-4 rounded-lg shadow-md mb-4">
        <h3 class="font-bold text-lg mb-3">Pruebas de Validaci√≥n</h3>
        
        <div class="validation-tests">
          <!-- Prueba de Independencia -->
          <div class="test-item" [ngClass]="validationResults.independenceTest.passed ? 'test-passed' : 'test-failed'">
            <div class="test-header">
              <span class="test-icon">{{ validationResults.independenceTest.passed ? '‚úì' : '‚úó' }}</span>
              <h4 class="test-title">Prueba de Independencia</h4>
            </div>
            <div class="test-details">
              <p><strong>M√©todo:</strong> Coeficiente de Correlaci√≥n de Pearson</p>
              <p><strong>Correlaci√≥n:</strong> {{ validationResults.independenceTest.correlation.toFixed(6) }}</p>
              <p><strong>Umbral:</strong> &lt; {{ validationResults.independenceTest.threshold }}</p>
              <p class="test-result">
                {{ validationResults.independenceTest.passed ? 
                   '‚úì N√∫meros independientes' : 
                   '‚úó Correlaci√≥n significativa detectada' }}
              </p>
            </div>
          </div>

          <!-- Prueba de Uniformidad -->
          <div class="test-item" [ngClass]="validationResults.uniformityTest.passed ? 'test-passed' : 'test-failed'">
            <div class="test-header">
              <span class="test-icon">{{ validationResults.uniformityTest.passed ? '‚úì' : '‚úó' }}</span>
              <h4 class="test-title">Prueba de Uniformidad</h4>
            </div>
            <div class="test-details">
              <p><strong>M√©todo:</strong> Prueba Chi-cuadrado (œá¬≤)</p>
              <p><strong>œá¬≤ calculado:</strong> {{ validationResults.uniformityTest.chiSquare.toFixed(4) }}</p>
              <p><strong>œá¬≤ cr√≠tico:</strong> {{ validationResults.uniformityTest.criticalValue.toFixed(4) }}</p>
              <p><strong>Grados de libertad:</strong> {{ validationResults.uniformityTest.degreesOfFreedom }}</p>
              <p class="test-result">
                {{ validationResults.uniformityTest.passed ? 
                   '‚úì Distribuci√≥n uniforme' : 
                   '‚úó Distribuci√≥n no uniforme' }}
              </p>
            </div>
          </div>
        </div>

        <!-- Resultado General -->
        <div class="overall-result" [ngClass]="validationResults.overallValid ? 'result-valid' : 'result-invalid'">
          <p class="overall-message">
            <strong>{{ validationResults.overallValid ? '‚úì N√öMEROS V√ÅLIDOS' : '‚úó N√öMEROS NO V√ÅLIDOS' }}</strong>
          </p>
          <button *ngIf="!validationResults.overallValid" 
                  (click)="regenerate()"
                  class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-2 rounded font-semibold transition mt-2">
            üîÑ Regenerar con Nueva Semilla
          </button>
        </div>
      </div>

      <!-- Results table -->
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="font-bold text-lg mb-3">Valores Generados</h3>
        <div class="overflow-x-auto max-h-96 overflow-y-auto">
          <table class="w-full border-collapse">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="border px-4 py-2">√çndice (k)</th>
                <th class="border px-4 py-2">Valor (X‚Çñ)</th>
                <th class="border px-4 py-2">Normalizado (u‚Çñ)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of results" class="hover:bg-gray-50">
                <td class="border px-4 py-2 text-center">{{ r.index }}</td>
                <td class="border px-4 py-2 text-center">{{ r.value }}</td>
                <td class="border px-4 py-2 text-center">{{ r.normalized.toFixed(6) }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
